<Project>
  <Import Project="..\build\Directory.Build.props" />

  <!-- General properties for published projects-->
  <PropertyGroup>

    <!-- Generate documentation files (only for published, non source generator projects) -->
    <GenerateDocumentationFile Condition="$(IsPackagedProject)">true</GenerateDocumentationFile>
    <DocumentationFile Condition="'$(GenerateDocumentationFile)' == 'true'">$(MSBuildProjectName).xml</DocumentationFile>

    <!-- Disable packing symbols for source generators -->
    <PackSymbols Condition="$(IsSourceGeneratorProject)">false</PackSymbols>

    <!-- Check whether the project has a .targets file to bundle -->
    <IsTargetsFileAvailableForPacking>false</IsTargetsFileAvailableForPacking>
    <IsTargetsFileAvailableForPacking Condition="$(IsPackagedProject) AND Exists('$(MSBuildProjectName).targets')">true</IsTargetsFileAvailableForPacking>
  </PropertyGroup>

  <!-- Additional items for published projects -->
  <ItemGroup Label="Package">

    <!-- Pack the NuGet icon file -->
    <None Condition="$(IsPackagedProject)" Include="$(MSBuildThisFileDirectory)..\assets\icon.png" Pack="true" PackagePath="\" Visible="False" />

    <!-- Pack .targets files, if present -->
    <None Condition="$(IsTargetsFileAvailableForPacking)" Include="$(MSBuildProjectName).targets" PackagePath="buildTransitive" Pack="true" />
    <None Condition="$(IsTargetsFileAvailableForPacking)" Include="$(MSBuildProjectName).targets" PackagePath="build" Pack="true" />
  </ItemGroup>

  <!--
    Reference PolySharp for all .NET Standard 2.0 polyfills.
    Only needed for the .Core project and all source generators.
  -->
  <ItemGroup Condition="'$(MSBuildProjectName)' == 'ComputeSharp.Core' OR $(MSBuildProjectName.EndsWith('.SourceGenerators'))">
    <PackageReference Include="PolySharp" Version="1.12.1">
      <PrivateAssets>all</PrivateAssets>
      <IncludeAssets>build;analyzers</IncludeAssets>
    </PackageReference>
  </ItemGroup>

  <!-- Define the type alias for [UnmanagedCallersOnly] when on the .NET Standard 2.0 target -->
  <ItemGroup Condition="'$(TargetFramework)' == 'netstandard2.0'">
    <Using Include="System.Runtime.InteropServices2.UnmanagedCallersOnlyAttribute" Alias="UnmanagedCallersOnlyAttribute" />
  </ItemGroup>

  <!-- Configure PolySharp options -->
  <PropertyGroup>
    <PolySharpIncludeRuntimeSupportedAttributes>true</PolySharpIncludeRuntimeSupportedAttributes>
    <PolySharpUseInteropServices2NamespaceForUnmanagedCallersOnlyAttribute>true</PolySharpUseInteropServices2NamespaceForUnmanagedCallersOnlyAttribute>
  </PropertyGroup>
</Project>